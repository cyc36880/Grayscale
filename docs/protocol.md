 ## 一、设备地址配置

设备支持双地址，除通用地址外，可以通过长按按键切换第二地址，地址指示灯与地址的对应关系如下：

| 设备地址（十六进制） | 颜色标识 |
| :------------------: | :------: |
|       **0x6F**       | 通用地址 |
|       **0x71**       |   红色   |
|       **0x72**       |   绿色   |
|       **0x73**       |   蓝色   |
|       **0x74**       |   紫色   |



------

 ## 二、核心功能说明

 ### 1. 训练与识别特性

 - **自动阈值记录**：完成颜色/灰度/二值训练后，系统将自动保存当前阈值参数至非易失性存储，无需手动存储。

 - **训练完整性要求**：训练过程中必须确保所有颜色通道（或对应端口）均被有效扫描到；若任一通道未被扫描，将导致该通道的识别精度显著下降（可能出现误判或漏判）。

------

 ## 三、通信协议规范

 ### 1. 命令设置（控制指令）

 通过写入单字节命令（0x00~0x15）控制模块工作模式，具体定义如下：

 | 命令标识（十进制） |                       功能描述                        |
 | -----------------: | :---------------------------------------------------: |
 |                  0 |        空闲模式（无操作，传感器保持待机状态）         |
 |                  1 |      颜色识别模式（检测并输出当前目标颜色类型）       |
 |                  2 |      灰度识别模式（检测并输出当前目标灰度等级）       |
 |                  3 |     二值识别模式（检测并输出当前目标二值化状态）      |
 |                  4 |         灰度学习模式（进入灰度阈值训练状态）          |
 |                  5 |        二值学习模式（进入二值化阈值训练状态）         |
 |                  6 |     清除所有已存储的颜色学习数据（恢复默认阈值）      |
 |                  7 |       学习红色阈值（针对红色通道单独训练阈值）        |
 |                  8 |       学习绿色阈值（针对绿色通道单独训练阈值）        |
 |                  9 |       学习蓝色阈值（针对蓝色通道单独训练阈值）        |
 |                 10 |        学习黄色阈值（针对黄色混合色训练阈值）         |
 |                 11 |        学习青色阈值（针对青色混合色训练阈值）         |
 |                 12 |        学习紫色阈值（针对紫色混合色训练阈值）         |
 |                 13 | <font color='red'>保留（暂未开放功能）</font> :sweat: |
 |                 14 | <font color='red'>保留（暂未开放功能）</font> :sweat: |
 |                 15 |        读取原始光敏值（输出0~255范围的模拟量）        |

 > **关键约束**：单次通信仅允许写入 **1字节命令**；连续写入多字节（如误发多命令）将导致设备死机，需严格遵循单字节写入规则。

------

 ### 2. 读取规范（状态反馈）

 模块响应读取请求时，需按固定格式解析返回的 **7字节数据包**，具体结构如下：

 |  字节位置 |        数据内容         |                             说明                             |
 | --------: | :---------------------: | :----------------------------------------------------------: |
 | 第1~6字节 | 各通道检测值（6路独立） | 每个字节对应一路输入信号的识别结果（具体含义参考“颜色识别读取值”表） |
 |   第7字节 |      模块状态标识       | 表示当前模块的工作模式状态（与“命令设置”中的标识一致，用于确认模式切换成功） |

 > **强制要求**：必须完整读取 **7字节**；若读取字节数不足（如仅读6字节），可能导致设备内部状态机紊乱，进而引发死机或数据异常。
 >
 > **时序提示**：因传感器内部模式切换需耗时处理，设置新命令后立即读取可能返回旧模式下的残留数据。建议在写入命令后增加 **适当延时（如50~100ms）**，确保模块完成模式切换后再执行读取操作。

------

 ### 3. 颜色识别读取值映射表

 模块在颜色识别模式（命令1）或相关学习模式下，返回的第1~6字节对应各通道的颜色类型，具体标识如下：

 |     颜色类型 | 返回标识（十进制） |
 | -----------: | :----------------: |
 | 未检测到颜色 |         0          |
 |         红色 |         1          |
 |         绿色 |         2          |
 |         蓝色 |         3          |
 |         黄色 |         4          |
 |         青色 |         5          |
 |         紫色 |         6          |
 |         黑色 |         7          |
 |         白色 |         8          |

 > 注：标识值直接映射传感器对目标颜色的分类结果，可用于后续逻辑判断或显示输出。

------

 ## 四、典型应用约束

 1. **写入安全**：严格限制单次通信仅发送1字节命令；多字节写入（如批量发命令+参数）需通过应用层拆解为多次单字节操作。
 2. **读取完整性**：所有状态读取必须按7字节固定长度获取，禁止截断或部分读取。
 3. **时序控制**：模式切换后需加入软件延时（建议50~100ms），避免因传感器响应延迟导致数据错误。
 4. **训练有效性**：执行颜色/灰度/二值学习时，需确保环境光照稳定且目标颜色覆盖完整，否则可能导致阈值训练不准确。

------

 *（本协议适用于多通道颜色传感器的精准控制与数据交互，用户需严格遵循通信时序与数据格式要求，以保障系统稳定性和识别精度。）*